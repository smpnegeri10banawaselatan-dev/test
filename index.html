<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Peralatan dan Mesin — Data dari Google Sheets</title>
  <style>
    :root{
      --bg:#0b1020; --card:#121935; --muted:#8ea0ff; --text:#e7ebff; --accent:#6ea8fe; --border:#223063;
    }
    body{
      margin:0;
      font-family:ui-sans-serif,system-ui;
      background:var(--bg);
      color:var(--text);
      display:flex;
      height:100vh;
      overflow:hidden;
    }
    nav{
      width:220px;
      background:var(--card);
      border-right:1px solid var(--border);
      display:flex;
      flex-direction:column;
    }
    nav h2{
      margin:0;
      padding:1rem;
      font-size:1.2rem;
      border-bottom:1px solid var(--border);
    }
    nav ul{
      list-style:none;
      margin:0;
      padding:0;
      flex:1;
      overflow:auto;
    }
    nav li{
      padding:.8rem 1rem;
      cursor:pointer;
      border-bottom:1px solid var(--border);
    }
    nav li:hover{
      background:var(--accent);
      color:#000;
    }
    main{
      flex:1;
      display:flex;
      flex-direction:column;
      overflow:auto;
    }
    header{
      position:sticky;
      top:0;
      background:#0b1020cc;
      padding:1rem;
      border-bottom:1px solid var(--border);
      z-index:1;
    }
    h1{margin:0;font-size:1.5rem}
    input,button{padding:.5rem;border-radius:.5rem;border:1px solid var(--border)}
    input{flex:1;min-width:200px;background:#0f1730;color:var(--text)}
    button{background:var(--accent);color:#000;cursor:pointer}
    .controls{display:flex;gap:.5rem;margin-top:.5rem}
    .table-wrapper{overflow:auto;padding:1rem;flex:1}
    table{width:100%;border-collapse:collapse}
    th,td{padding:.5rem;border-bottom:1px solid var(--border);vertical-align:top}
    th{background:#0f1730;color:var(--muted);cursor:pointer;white-space:nowrap}
    tbody tr:hover{background:#0f1730}
    #status{padding:0 1rem 1rem 1rem;}
  </style>
</head>
<body>
  <nav>
    <h2>Kecamatan</h2>
    <ul>
      <li>Kecamatan Banawa</li>
      <li>Kecamatan Banawa Tengah</li>
      <li>Kecamatan Balanipa</li>
      <li>Kecamatan Duampanua</li>
      <li>Kecamatan Marobo</li>
      <li>Kecamatan Labuan</li>
      <li>Kecamatan Tapalang</li>
      <li>Kecamatan Tapalang Barat</li>
      <li>Kecamatan Tinambung</li>
      <li>Kecamatan Tinambung Barat</li>
      <li>Kecamatan Mapilli</li>
      <li>Kecamatan Campalagian</li>
      <li>Kecamatan Luyo</li>
      <li>Kecamatan Wonomulyo</li>
      <li>Kecamatan Polewali</li>
      <li>Kecamatan Anreapi</li>
    </ul>
  </nav>
  <main>
    <header>
      <h1>Peralatan dan Mesin</h1>
      <div class="controls">
        <input id="search" type="search" placeholder="Cari…" />
        <button id="download">Unduh CSV</button>
        <button id="reload">Muat ulang</button>
      </div>
    </header>
    <div class="table-wrapper">
      <table>
        <thead></thead>
        <tbody></tbody>
      </table>
    </div>
    <p id="status"></p>
  </main>
  <script>
    const ENDPOINT = "https://opensheet.elk.sh/152oNQyrJEeg-xW3okB2LKbGIUapxDakDMCbDjqpDl3U/Peralatan%20dan%20Mesin";

    const columns = [
      "Urut","Pengguna Barang","Kode Barang","Nama Barang",
      "Konfirmasi Keberadaan","Kondisi","Label BMD (selain Kendaraan)","Penggunaan",
      "Nama Pengguna (Jika Penggunaan : Digunakan Pegawai)",
      "Status Pegawai Pengguna (Jika Penggunaan : Digunakan Pegawai)",
      "Keterangan Tambahan","NIBAR","Merek/tipe","Nomor Polisi","Nomor Rangka","Nomor BPKB",
      "Nilai Perolehan","Cara Perolehan","Perolehan","Status Penggunaan"
    ];

    const thead = document.querySelector('thead');
    const tbody = document.querySelector('tbody');
    const status = document.getElementById('status');
    const search = document.getElementById('search');
    let data = [];

    function renderTable(rows){
      thead.innerHTML = '<tr>' + columns.map(c=>`<th>${c.replace(/\n/g,'<br>')}</th>`).join('') + '</tr>';
      tbody.innerHTML = rows.map(r=>'<tr>' + columns.map(c=>`<td>${r[c]||''}</td>`).join('') + '</tr>').join('');
    }

    async function load(){
      status.textContent = 'Memuat data…';
      try{
        const res = await fetch(ENDPOINT);
        if(!res.ok) throw new Error(res.statusText);
        data = await res.json();
        renderTable(data);
        status.textContent = `${data.length} baris dimuat. Terakhir diperbarui: ${new Date().toLocaleTimeString()}`;
      }catch(e){
        status.textContent = 'Gagal memuat data: ' + e.message;
      }
    }

    function filterData(){
      const q = search.value.toLowerCase();
      const filtered = data.filter(row => columns.some(c => (row[c]||'').toLowerCase().includes(q)));
      renderTable(filtered);
    }

    function downloadCSV(){
      const rows = [columns, ...data.map(r => columns.map(c => r[c]||''))];
      const csv = rows.map(r => r.map(v => '"'+String(v).replace(/"/g,'""')+'"').join(',')).join('\n');
      const blob = new Blob(["\ufeff"+csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'Peralatan_dan_Mesin.csv';
      document.body.appendChild(a); a.click(); document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    document.getElementById('reload').onclick = load;
    document.getElementById('download').onclick = downloadCSV;
    search.oninput = filterData;

    load();
    setInterval(load, 10000);
  </script>
</body>
</html>
